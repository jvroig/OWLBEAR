============================= test session starts ==============================
platform darwin -- Python 3.9.6, pytest-8.3.5, pluggy-1.5.0
rootdir: /Users/jvroig/Dev/OWLBEAR
configfile: pytest.ini
testpaths: tests
plugins: anyio-4.9.0, asyncio-0.26.0, mock-3.14.0, cov-6.1.1
asyncio: mode=auto, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collected 56 items

tests/integration/test_workflow_execution.py ...F..                      [ 10%]
tests/performance/test_performance.py .F...                              [ 19%]
tests/test_scripts/test_complex_action_loading.py .                      [ 21%]
tests/test_scripts/test_complex_actions.py ..                            [ 25%]
tests/test_scripts/test_owlbear_engine.py ....                           [ 32%]
tests/unit/test_complex_actions.py F.FF.                                 [ 41%]
tests/unit/test_events.py ..........                                     [ 58%]
tests/unit/test_id_based_loopback.py ......                              [ 69%]
tests/unit/test_owlbear_engine.py ........F.                             [ 87%]
tests/unit/test_workflow_validator.py .......                            [100%]

=================================== FAILURES ===================================
________________________ test_complex_action_execution _________________________

mock_call_agent = <MagicMock name='call_agent' id='4348701520'>
test_files_path = <function test_files_path.<locals>._get_path at 0x1035204c0>
temp_output_dir = '/Users/jvroig/Dev/OWLBEAR/tests/outputs/pytest_temp'

    @pytest.mark.integration
    @patch('owlbear.call_agent')
    def test_complex_action_execution(mock_call_agent, test_files_path, temp_output_dir):
        """Test execution of a workflow with a COMPLEX action."""
        # Set up mock responses
        mock_call_agent.return_value = create_mock_expert_response("Complex action response")
    
        # Create a path for the complex action definition
        complex_action_path = os.path.join(test_files_path("sample_complex_actions"), "polished_output.yml")
    
        # Ensure the complex action file exists
        if not os.path.exists(complex_action_path):
            pytest.skip(f"Complex action file not found: {complex_action_path}")
    
        # Create a workflow with a COMPLEX action
        actions = [
            create_sample_complex_action(
                action_name="polished_output",
                output="complex_output"
            )
        ]
        workflow = create_sample_workflow(actions)
    
        with temp_workflow_file(workflow) as workflow_path:
            # Execute the workflow
            engine = WorkflowEngine(workflow_path)
            result = engine.run()
    
            # Check the result
>           assert result is True
E           assert False is True

tests/integration/test_workflow_execution.py:135: AssertionError
----------------------------- Captured stderr call -----------------------------
2025-05-11 11:54:40,167 - workflow-engine - INFO - Created output directory: outputs/tmpvmkghnod_2025-05-11-11-54
2025-05-11 11:54:40,167 - workflow-engine - INFO - Created debug log file: outputs/tmpvmkghnod_2025-05-11-11-54/workflow_execution.log
2025-05-11 11:54:40,168 - workflow-engine - INFO - Expanding complex action: polished_output
2025-05-11 11:54:40,168 - workflow-engine.complex - ERROR - Complex action 'polished_output' not found in /Users/jvroig/Dev/OWLBEAR/actions/complex
2025-05-11 11:54:40,168 - workflow-engine - ERROR - Failed to load complex action 'polished_output'
2025-05-11 11:54:40,168 - workflow-engine - INFO - Workflow now has 1 actions after expansion
2025-05-11 11:54:40,168 - workflow-engine - INFO - Found 1 required strings in workflow: STR_USER_INPUT
2025-05-11 11:54:40,168 - workflow-engine - INFO - Loaded workflow with 1 actions
2025-05-11 11:54:40,168 - workflow-engine - INFO - Validating workflow before execution
2025-05-11 11:54:40,168 - workflow-validator - INFO - Output directory: outputs/tmpvmkghnod_2025-05-11-11-54
2025-05-11 11:54:40,169 - workflow-validator - INFO - Loaded workflow with 1 actions
2025-05-11 11:54:40,169 - workflow-engine.complex - ERROR - Complex action 'polished_output' not found in /Users/jvroig/Dev/OWLBEAR/actions/complex
2025-05-11 11:54:40,169 - workflow-validator - ERROR - Validation error: Action 1 (COMPLEX) references unknown complex action 'polished_output'
2025-05-11 11:54:40,169 - workflow-validator - ERROR - Validation failed with 1 errors:
2025-05-11 11:54:40,169 - workflow-validator - ERROR -   1. Action 1 (COMPLEX) references unknown complex action 'polished_output'
2025-05-11 11:54:40,169 - workflow-engine - ERROR - Workflow validation failed! See validator output for details.
2025-05-11 11:54:40,169 - workflow-engine - ERROR - Workflow validation failed. Aborting execution.
2025-05-11 11:54:40,169 - workflow-engine.events - ERROR - Workflow validation failed. Aborting execution.
------------------------------ Captured log call -------------------------------
INFO     workflow-engine:owlbear.py:75 Created output directory: outputs/tmpvmkghnod_2025-05-11-11-54
INFO     workflow-engine:owlbear.py:82 Created debug log file: outputs/tmpvmkghnod_2025-05-11-11-54/workflow_execution.log
INFO     workflow-engine:owlbear.py:213 Expanding complex action: polished_output
ERROR    workflow-engine.complex:complex.py:34 Complex action 'polished_output' not found in /Users/jvroig/Dev/OWLBEAR/actions/complex
ERROR    workflow-engine:owlbear.py:218 Failed to load complex action 'polished_output'
INFO     workflow-engine:owlbear.py:241 Workflow now has 1 actions after expansion
INFO     workflow-engine:owlbear.py:270 Found 1 required strings in workflow: STR_USER_INPUT
INFO     workflow-engine:owlbear.py:192 Loaded workflow with 1 actions
INFO     workflow-engine:owlbear.py:509 Validating workflow before execution
INFO     workflow-validator:workflow_validator.py:294 Output directory: outputs/tmpvmkghnod_2025-05-11-11-54
INFO     workflow-validator:workflow_validator.py:80 Loaded workflow with 1 actions
ERROR    workflow-engine.complex:complex.py:34 Complex action 'polished_output' not found in /Users/jvroig/Dev/OWLBEAR/actions/complex
ERROR    workflow-validator:workflow_validator.py:44 Validation error: Action 1 (COMPLEX) references unknown complex action 'polished_output'
ERROR    workflow-validator:workflow_validator.py:308 Validation failed with 1 errors:
ERROR    workflow-validator:workflow_validator.py:310   1. Action 1 (COMPLEX) references unknown complex action 'polished_output'
ERROR    workflow-engine:owlbear.py:528 Workflow validation failed! See validator output for details.
ERROR    workflow-engine:owlbear.py:542 Workflow validation failed. Aborting execution.
ERROR    workflow-engine.events:event_emitter.py:127 Workflow validation failed. Aborting execution.
__________________ test_complex_action_expansion_performance ___________________

mock_call_agent = <MagicMock name='call_agent' id='4350583712'>
test_files_path = <function test_files_path.<locals>._get_path at 0x1034249d0>
temp_output_dir = '/Users/jvroig/Dev/OWLBEAR/tests/outputs/pytest_temp'
monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x103511070>

    @pytest.mark.performance
    @patch('owlbear.call_agent')
    def test_complex_action_expansion_performance(mock_call_agent, test_files_path, temp_output_dir, monkeypatch):
        """Test performance of complex action expansion."""
        # Set up mock response
        mock_call_agent.return_value = create_mock_expert_response("Test response")
    
        # Create polished_output.yml in the sample_complex_actions directory first
        test_complex_action = {
            "ACTIONS": [
                {
                    "PROMPT": {
                        "id": "polished_action_1",
                        "expert": "{{expert}}",
                        "inputs": [
                            "Creating polished output for {{instruction}}",
                            "Additional info: {{another_data}}",
                            "Extra context: {{and_another}}"
                        ],
                        "output": "step1_output"
                    }
                },
                {
                    "PROMPT": {
                        "id": "polished_action_2",
                        "expert": "{{expert}}",
                        "inputs": [
                            "Reviewing draft for {{instruction}}",
                            "step1_output"
                        ],
                        "output": "step2_output"
                    }
                },
                {
                    "PROMPT": {
                        "id": "polished_action_3",
                        "expert": "{{expert}}",
                        "inputs": [
                            "Finalizing output for {{instruction}}",
                            "step1_output",
                            "step2_output"
                        ],
                        "output": "{{output}}"
                    }
                }
            ]
        }
    
        # Save the test complex action to the sample_complex_actions directory
        complex_action_dir = os.path.join(test_files_path("sample_complex_actions"))
        os.makedirs(complex_action_dir, exist_ok=True)
        complex_action_path = os.path.join(complex_action_dir, "polished_output.yml")
        with open(complex_action_path, 'w') as f:
            yaml.dump(test_complex_action, f)
    
        # Create a workflow with many complex actions
        actions = []
        for i in range(10):  # 10 complex actions, each will expand to 3 basic actions
            actions.append(create_sample_complex_action(
                action_name="polished_output",
                expert="CEO",
                data={
                    "instruction": f"Instruction for complex action {i}",
                    "another_data": f"Additional data for complex action {i}",
                    "and_another": f"More data for complex action {i}"
                },
                output=f"complex_output_{i}"
            ))
    
        workflow = create_sample_workflow(actions)
    
        # Create a temp workflow file
        workflow_path = os.path.join(temp_output_dir, "perf_complex_test.yml")
        with open(workflow_path, 'w') as f:
            yaml.dump(workflow, f)
    
        # Measure time to load and expand workflow
        start_time = time.time()
    
        engine = WorkflowEngine(workflow_path, skip_validation=True)
        load_result = engine.load_workflow()
    
        expansion_time = time.time() - start_time
    
        # Assertions
        assert load_result is True
        # Each complex action expands to 3 basic actions, so 10 complex â†’ 30 basic
>       assert len(engine.workflow['ACTIONS']) > len(actions), "Complex actions should be expanded"
E       AssertionError: Complex actions should be expanded
E       assert 10 > 10
E        +  where 10 = len([{'COMPLEX': {'action': 'polished_output', 'data': {'and_another': 'More data for complex action 0', 'another_data': '...ex action 5', 'instruction': 'Instruction for complex action 5'}, 'expert': 'CEO', 'output': 'complex_output_5'}}, ...])
E        +  and   10 = len([{'COMPLEX': {'action': 'polished_output', 'data': {'and_another': 'More data for complex action 0', 'another_data': '...ex action 5', 'instruction': 'Instruction for complex action 5'}, 'expert': 'CEO', 'output': 'complex_output_5'}}, ...])

tests/performance/test_performance.py:165: AssertionError
----------------------------- Captured stderr call -----------------------------
2025-05-11 11:54:40,268 - workflow-engine - INFO - Created output directory: outputs/perf_complex_test_2025-05-11-11-54
2025-05-11 11:54:40,268 - workflow-engine - INFO - Created debug log file: outputs/perf_complex_test_2025-05-11-11-54/workflow_execution.log
2025-05-11 11:54:40,273 - workflow-engine - INFO - Expanding complex action: polished_output
2025-05-11 11:54:40,273 - workflow-engine.complex - ERROR - Complex action 'polished_output' not found in /Users/jvroig/Dev/OWLBEAR/actions/complex
2025-05-11 11:54:40,273 - workflow-engine - ERROR - Failed to load complex action 'polished_output'
2025-05-11 11:54:40,273 - workflow-engine - INFO - Expanding complex action: polished_output
2025-05-11 11:54:40,273 - workflow-engine.complex - ERROR - Complex action 'polished_output' not found in /Users/jvroig/Dev/OWLBEAR/actions/complex
2025-05-11 11:54:40,273 - workflow-engine - ERROR - Failed to load complex action 'polished_output'
2025-05-11 11:54:40,273 - workflow-engine - INFO - Expanding complex action: polished_output
2025-05-11 11:54:40,273 - workflow-engine.complex - ERROR - Complex action 'polished_output' not found in /Users/jvroig/Dev/OWLBEAR/actions/complex
2025-05-11 11:54:40,273 - workflow-engine - ERROR - Failed to load complex action 'polished_output'
2025-05-11 11:54:40,273 - workflow-engine - INFO - Expanding complex action: polished_output
2025-05-11 11:54:40,273 - workflow-engine.complex - ERROR - Complex action 'polished_output' not found in /Users/jvroig/Dev/OWLBEAR/actions/complex
2025-05-11 11:54:40,273 - workflow-engine - ERROR - Failed to load complex action 'polished_output'
2025-05-11 11:54:40,273 - workflow-engine - INFO - Expanding complex action: polished_output
2025-05-11 11:54:40,273 - workflow-engine.complex - ERROR - Complex action 'polished_output' not found in /Users/jvroig/Dev/OWLBEAR/actions/complex
2025-05-11 11:54:40,273 - workflow-engine - ERROR - Failed to load complex action 'polished_output'
2025-05-11 11:54:40,274 - workflow-engine - INFO - Expanding complex action: polished_output
2025-05-11 11:54:40,274 - workflow-engine.complex - ERROR - Complex action 'polished_output' not found in /Users/jvroig/Dev/OWLBEAR/actions/complex
2025-05-11 11:54:40,274 - workflow-engine - ERROR - Failed to load complex action 'polished_output'
2025-05-11 11:54:40,274 - workflow-engine - INFO - Expanding complex action: polished_output
2025-05-11 11:54:40,274 - workflow-engine.complex - ERROR - Complex action 'polished_output' not found in /Users/jvroig/Dev/OWLBEAR/actions/complex
2025-05-11 11:54:40,274 - workflow-engine - ERROR - Failed to load complex action 'polished_output'
2025-05-11 11:54:40,274 - workflow-engine - INFO - Expanding complex action: polished_output
2025-05-11 11:54:40,274 - workflow-engine.complex - ERROR - Complex action 'polished_output' not found in /Users/jvroig/Dev/OWLBEAR/actions/complex
2025-05-11 11:54:40,274 - workflow-engine - ERROR - Failed to load complex action 'polished_output'
2025-05-11 11:54:40,274 - workflow-engine - INFO - Expanding complex action: polished_output
2025-05-11 11:54:40,274 - workflow-engine.complex - ERROR - Complex action 'polished_output' not found in /Users/jvroig/Dev/OWLBEAR/actions/complex
2025-05-11 11:54:40,274 - workflow-engine - ERROR - Failed to load complex action 'polished_output'
2025-05-11 11:54:40,274 - workflow-engine - INFO - Expanding complex action: polished_output
2025-05-11 11:54:40,274 - workflow-engine.complex - ERROR - Complex action 'polished_output' not found in /Users/jvroig/Dev/OWLBEAR/actions/complex
2025-05-11 11:54:40,274 - workflow-engine - ERROR - Failed to load complex action 'polished_output'
2025-05-11 11:54:40,274 - workflow-engine - INFO - Workflow now has 10 actions after expansion
2025-05-11 11:54:40,274 - workflow-engine - INFO - Found 1 required strings in workflow: STR_USER_INPUT
2025-05-11 11:54:40,274 - workflow-engine - INFO - Loaded workflow with 10 actions
------------------------------ Captured log call -------------------------------
INFO     workflow-engine:owlbear.py:75 Created output directory: outputs/perf_complex_test_2025-05-11-11-54
INFO     workflow-engine:owlbear.py:82 Created debug log file: outputs/perf_complex_test_2025-05-11-11-54/workflow_execution.log
INFO     workflow-engine:owlbear.py:213 Expanding complex action: polished_output
ERROR    workflow-engine.complex:complex.py:34 Complex action 'polished_output' not found in /Users/jvroig/Dev/OWLBEAR/actions/complex
ERROR    workflow-engine:owlbear.py:218 Failed to load complex action 'polished_output'
INFO     workflow-engine:owlbear.py:213 Expanding complex action: polished_output
ERROR    workflow-engine.complex:complex.py:34 Complex action 'polished_output' not found in /Users/jvroig/Dev/OWLBEAR/actions/complex
ERROR    workflow-engine:owlbear.py:218 Failed to load complex action 'polished_output'
INFO     workflow-engine:owlbear.py:213 Expanding complex action: polished_output
ERROR    workflow-engine.complex:complex.py:34 Complex action 'polished_output' not found in /Users/jvroig/Dev/OWLBEAR/actions/complex
ERROR    workflow-engine:owlbear.py:218 Failed to load complex action 'polished_output'
INFO     workflow-engine:owlbear.py:213 Expanding complex action: polished_output
ERROR    workflow-engine.complex:complex.py:34 Complex action 'polished_output' not found in /Users/jvroig/Dev/OWLBEAR/actions/complex
ERROR    workflow-engine:owlbear.py:218 Failed to load complex action 'polished_output'
INFO     workflow-engine:owlbear.py:213 Expanding complex action: polished_output
ERROR    workflow-engine.complex:complex.py:34 Complex action 'polished_output' not found in /Users/jvroig/Dev/OWLBEAR/actions/complex
ERROR    workflow-engine:owlbear.py:218 Failed to load complex action 'polished_output'
INFO     workflow-engine:owlbear.py:213 Expanding complex action: polished_output
ERROR    workflow-engine.complex:complex.py:34 Complex action 'polished_output' not found in /Users/jvroig/Dev/OWLBEAR/actions/complex
ERROR    workflow-engine:owlbear.py:218 Failed to load complex action 'polished_output'
INFO     workflow-engine:owlbear.py:213 Expanding complex action: polished_output
ERROR    workflow-engine.complex:complex.py:34 Complex action 'polished_output' not found in /Users/jvroig/Dev/OWLBEAR/actions/complex
ERROR    workflow-engine:owlbear.py:218 Failed to load complex action 'polished_output'
INFO     workflow-engine:owlbear.py:213 Expanding complex action: polished_output
ERROR    workflow-engine.complex:complex.py:34 Complex action 'polished_output' not found in /Users/jvroig/Dev/OWLBEAR/actions/complex
ERROR    workflow-engine:owlbear.py:218 Failed to load complex action 'polished_output'
INFO     workflow-engine:owlbear.py:213 Expanding complex action: polished_output
ERROR    workflow-engine.complex:complex.py:34 Complex action 'polished_output' not found in /Users/jvroig/Dev/OWLBEAR/actions/complex
ERROR    workflow-engine:owlbear.py:218 Failed to load complex action 'polished_output'
INFO     workflow-engine:owlbear.py:213 Expanding complex action: polished_output
ERROR    workflow-engine.complex:complex.py:34 Complex action 'polished_output' not found in /Users/jvroig/Dev/OWLBEAR/actions/complex
ERROR    workflow-engine:owlbear.py:218 Failed to load complex action 'polished_output'
INFO     workflow-engine:owlbear.py:241 Workflow now has 10 actions after expansion
INFO     workflow-engine:owlbear.py:270 Found 1 required strings in workflow: STR_USER_INPUT
INFO     workflow-engine:owlbear.py:192 Loaded workflow with 10 actions
___________________________ test_load_complex_action ___________________________

test_files_path = <function test_files_path.<locals>._get_path at 0x1036268b0>

    def test_load_complex_action(test_files_path):
        """Test loading a complex action from a file."""
        # Try to load a complex action that exists
        action_def = load_complex_action("polished_output")
    
        # Check the result
>       assert action_def is not None
E       assert None is not None

tests/unit/test_complex_actions.py:15: AssertionError
----------------------------- Captured stderr call -----------------------------
2025-05-11 11:54:40,988 - workflow-engine.complex - ERROR - Complex action 'polished_output' not found in /Users/jvroig/Dev/OWLBEAR/actions/complex
------------------------------ Captured log call -------------------------------
ERROR    workflow-engine.complex:complex.py:34 Complex action 'polished_output' not found in /Users/jvroig/Dev/OWLBEAR/actions/complex
__________________________ test_expand_complex_action __________________________

test_files_path = <function test_files_path.<locals>._get_path at 0x103626f70>

    def test_expand_complex_action(test_files_path):
        """Test expanding a complex action with variables."""
        # Load a complex action
        action_def = load_complex_action("polished_output")
>       assert action_def is not None
E       assert None is not None

tests/unit/test_complex_actions.py:67: AssertionError
----------------------------- Captured stderr call -----------------------------
2025-05-11 11:54:40,991 - workflow-engine.complex - ERROR - Complex action 'polished_output' not found in /Users/jvroig/Dev/OWLBEAR/actions/complex
------------------------------ Captured log call -------------------------------
ERROR    workflow-engine.complex:complex.py:34 Complex action 'polished_output' not found in /Users/jvroig/Dev/OWLBEAR/actions/complex
_____________________________ test_output_linking ______________________________

test_files_path = <function test_files_path.<locals>._get_path at 0x1036261f0>

    def test_output_linking(test_files_path):
        """Test that the last action's output is linked to the complex action output."""
        # Load a complex action
        action_def = load_complex_action("polished_output")
>       assert action_def is not None
E       assert None is not None

tests/unit/test_complex_actions.py:112: AssertionError
----------------------------- Captured stderr call -----------------------------
2025-05-11 11:54:40,993 - workflow-engine.complex - ERROR - Complex action 'polished_output' not found in /Users/jvroig/Dev/OWLBEAR/actions/complex
------------------------------ Captured log call -------------------------------
ERROR    workflow-engine.complex:complex.py:34 Complex action 'polished_output' not found in /Users/jvroig/Dev/OWLBEAR/actions/complex
___________________ test_engine_decide_action_false_loopback ___________________

mock_decide_call = <MagicMock name='call_agent' id='4352061296'>
test_files_path = <function test_files_path.<locals>._get_path at 0x103677c10>
sample_workflow_factory = <function sample_workflow_factory.<locals>.create_workflow at 0x103677940>

    @patch('owlbear.call_agent')
    def test_engine_decide_action_false_loopback(mock_decide_call, test_files_path, sample_workflow_factory):
        """Test the DECIDE action that returns FALSE and loops back."""
        # Set up mock responses with the first returning FALSE and the second TRUE
        decide_mock = mock_decide_call([False, True])
    
        # Create a workflow with a DECIDE action
        workflow_path = sample_workflow_factory(include_decide=True)
    
        # Create an engine and run the workflow
        engine = WorkflowEngine(workflow_path, skip_validation=True)
        result = engine.run()
    
        # Test the result
>       assert result is True
E       assert False is True

tests/unit/test_owlbear_engine.py:196: AssertionError
----------------------------- Captured stderr call -----------------------------
2025-05-11 11:54:41,102 - workflow-engine - INFO - Created output directory: outputs/test_workflow_0_2025-05-11-11-54
2025-05-11 11:54:41,102 - workflow-engine - INFO - Created debug log file: outputs/test_workflow_0_2025-05-11-11-54/workflow_execution.log
2025-05-11 11:54:41,103 - workflow-engine - INFO - Workflow now has 2 actions after expansion
2025-05-11 11:54:41,103 - workflow-engine - INFO - Found 1 required strings in workflow: STR_USER_INPUT
2025-05-11 11:54:41,103 - workflow-engine - INFO - Loaded workflow with 2 actions
2025-05-11 11:54:41,103 - workflow-engine.events - INFO - Workflow started: test_workflow_0
2025-05-11 11:54:41,103 - workflow-engine - INFO - Executing step 1/2
2025-05-11 11:54:41,103 - workflow-engine.events - INFO - Step 0 started: PROMPT
2025-05-11 11:54:41,103 - workflow-engine.events - INFO - Expert started: CEO
2025-05-11 11:54:41,104 - workflow-engine.events - INFO - Expert ended: CEO
2025-05-11 11:54:41,110 - workflow-engine - ERROR - Failed to save output to outputs/test_workflow_0_2025-05-11-11-54/output_0.yaml: maximum recursion depth exceeded while calling a Python object
2025-05-11 11:54:41,116 - workflow-engine - ERROR - Failed to save output to outputs/test_workflow_0_2025-05-11-11-54/output_0_0001.yaml: maximum recursion depth exceeded while calling a Python object
2025-05-11 11:54:41,116 - workflow-engine.prompt - INFO - Step 1: PROMPT action completed successfully
2025-05-11 11:54:41,116 - workflow-engine.events - INFO - Step 0 ended: PROMPT (success: True)
2025-05-11 11:54:41,116 - workflow-engine - INFO - Executing step 2/2
2025-05-11 11:54:41,117 - workflow-engine.events - INFO - Step 1 started: DECIDE
2025-05-11 11:54:41,117 - workflow-engine.decide - INFO - DECIDE ACTION - Step 2: Starting with loopback_target=step_0
2025-05-11 11:54:41,117 - workflow-engine.decide - ERROR - Step 2: Error in DECIDE action: sequence item 1: expected str instance, MagicMock found
2025-05-11 11:54:41,117 - workflow-engine.events - ERROR - Error in DECIDE action (step 2): sequence item 1: expected str instance, MagicMock found
2025-05-11 11:54:41,117 - workflow-engine.events - INFO - Step 1 ended: DECIDE (success: False)
------------------------------ Captured log call -------------------------------
INFO     workflow-engine:owlbear.py:75 Created output directory: outputs/test_workflow_0_2025-05-11-11-54
INFO     workflow-engine:owlbear.py:82 Created debug log file: outputs/test_workflow_0_2025-05-11-11-54/workflow_execution.log
INFO     workflow-engine:owlbear.py:241 Workflow now has 2 actions after expansion
INFO     workflow-engine:owlbear.py:270 Found 1 required strings in workflow: STR_USER_INPUT
INFO     workflow-engine:owlbear.py:192 Loaded workflow with 2 actions
INFO     workflow-engine.events:event_emitter.py:130 Workflow started: test_workflow_0
INFO     workflow-engine:owlbear.py:594 Executing step 1/2
INFO     workflow-engine.events:event_emitter.py:136 Step 0 started: PROMPT
INFO     workflow-engine.events:event_emitter.py:142 Expert started: CEO
INFO     workflow-engine.events:event_emitter.py:145 Expert ended: CEO
ERROR    workflow-engine:owlbear.py:492 Failed to save output to outputs/test_workflow_0_2025-05-11-11-54/output_0.yaml: maximum recursion depth exceeded while calling a Python object
ERROR    workflow-engine:owlbear.py:492 Failed to save output to outputs/test_workflow_0_2025-05-11-11-54/output_0_0001.yaml: maximum recursion depth exceeded while calling a Python object
INFO     workflow-engine.prompt:prompt.py:79 Step 1: PROMPT action completed successfully
INFO     workflow-engine.events:event_emitter.py:139 Step 0 ended: PROMPT (success: True)
INFO     workflow-engine:owlbear.py:594 Executing step 2/2
INFO     workflow-engine.events:event_emitter.py:136 Step 1 started: DECIDE
INFO     workflow-engine.decide:decide.py:46 DECIDE ACTION - Step 2: Starting with loopback_target=step_0
ERROR    workflow-engine.decide:decide.py:139 Step 2: Error in DECIDE action: sequence item 1: expected str instance, MagicMock found
ERROR    workflow-engine.events:event_emitter.py:127 Error in DECIDE action (step 2): sequence item 1: expected str instance, MagicMock found
INFO     workflow-engine.events:event_emitter.py:139 Step 1 ended: DECIDE (success: False)
=============================== warnings summary ===============================
venv/lib/python3.9/site-packages/urllib3/__init__.py:35
  /Users/jvroig/Dev/OWLBEAR/venv/lib/python3.9/site-packages/urllib3/__init__.py:35: NotOpenSSLWarning: urllib3 v2 only supports OpenSSL 1.1.1+, currently the 'ssl' module is compiled with 'LibreSSL 2.8.3'. See: https://github.com/urllib3/urllib3/issues/3020
    warnings.warn(

venv/lib/python3.9/site-packages/_pytest/config/__init__.py:1441
  /Users/jvroig/Dev/OWLBEAR/venv/lib/python3.9/site-packages/_pytest/config/__init__.py:1441: PytestConfigWarning: Unknown config option: showlocals
  
    self._warn_or_fail_if_strict(f"Unknown config option: {key}\n")

venv/lib/python3.9/site-packages/_pytest/config/__init__.py:1441
  /Users/jvroig/Dev/OWLBEAR/venv/lib/python3.9/site-packages/_pytest/config/__init__.py:1441: PytestConfigWarning: Unknown config option: verbose
  
    self._warn_or_fail_if_strict(f"Unknown config option: {key}\n")

tests/test_scripts/test_complex_action_loading.py::test_complex_action_loading
  /Users/jvroig/Dev/OWLBEAR/venv/lib/python3.9/site-packages/_pytest/python.py:163: PytestReturnNotNoneWarning: Expected None, but tests/test_scripts/test_complex_action_loading.py::test_complex_action_loading returned True, which will be an error in a future version of pytest.  Did you mean to use `assert` instead of `return`?
    warnings.warn(

tests/test_scripts/test_complex_actions.py::test_complex_action_expansion
  /Users/jvroig/Dev/OWLBEAR/venv/lib/python3.9/site-packages/_pytest/python.py:163: PytestReturnNotNoneWarning: Expected None, but tests/test_scripts/test_complex_actions.py::test_complex_action_expansion returned True, which will be an error in a future version of pytest.  Did you mean to use `assert` instead of `return`?
    warnings.warn(

tests/test_scripts/test_complex_actions.py::test_complex_action_in_workflow
  /Users/jvroig/Dev/OWLBEAR/venv/lib/python3.9/site-packages/_pytest/python.py:163: PytestReturnNotNoneWarning: Expected None, but tests/test_scripts/test_complex_actions.py::test_complex_action_in_workflow returned True, which will be an error in a future version of pytest.  Did you mean to use `assert` instead of `return`?
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED tests/integration/test_workflow_execution.py::test_complex_action_execution
FAILED tests/performance/test_performance.py::test_complex_action_expansion_performance
FAILED tests/unit/test_complex_actions.py::test_load_complex_action - assert ...
FAILED tests/unit/test_complex_actions.py::test_expand_complex_action - asser...
FAILED tests/unit/test_complex_actions.py::test_output_linking - assert None ...
FAILED tests/unit/test_owlbear_engine.py::test_engine_decide_action_false_loopback
=================== 6 failed, 50 passed, 6 warnings in 1.07s ===================
